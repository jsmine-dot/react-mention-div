"use strict";var _react=_interopRequireDefault(require("react"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MentionBox;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var id=100,editBox=null,optionPopUp=null,activeNode=null,observer=new MutationObserver(function(a){console.log(a),observeBox(a)});function output(){var a={};return function(a){return void console.log("out",a)}}var outPut_=output();function MentionBox(){return/*#__PURE__*/_react.default.createElement("div",{ref:function ref(a){editBox=a,attachObserver(a,observer)},key:"alpha",style:{border:"1px solid"},contentEditable:!0,onClick:function onClick(a){return keyUp(a,props_.options)},onKeyDown:function onKeyDown(a){return keyDown(a,props_.options)},onKeyUp:function onKeyUp(a){return keyUp(a,props_.options)}})}function keyUp(a,b){focusInMention(b)}function keyDown(a){var b=window.getSelection();switch(a.key){case"@":{mentionTriggered(b.focusNode,b.focusOffset),a.preventDefault();break}case" ":{spaceTriggered(b.focusNode,b.focusNode.textContent.length);break}case"Backspace":case"Delete":{printSelectedNode();break}case"ArrowLeft":case"ArrowRight":default:}}function observeBox(a){var b=a[0];if(0<b.removedNodes.length){var c=0,d=editBox;b.previousSibling&&(d=b.previousSibling.childNodes.length?b.previousSibling.childNodes[0]:b.previousSibling,c=(d.textContent||d.innerText).length),focusAt(d,c)}else 0<b.addedNodes.length&&(b.addedNodes[0].chunk_id=++id)}function printSelectedNode(){var a=window.getSelection();console.log(a.focusNode)}function optionSelected(a){var b=a.target;if(console.log(a),!!activeNode){activeNode.textContent="@"+b.innerText,activeNode.mention_id=b.mention_id,activeNode.parentElement&&applyColor(activeNode.parentElement,"#3e9bdf");var c=new MutationObserver(function(a){return optionDeSelected(a[0].target)});c.observe(activeNode,{characterData:!0});var d=createEmptyTextNode();insertAfter(activeNode.parentElement,d),focusAt(d,1)}}function attachObserver(a,b){b.observe(a,{childList:!0})}function optionDeSelected(a){delete a.mention_id,console.log("--",a),a.parentElement&&applyColor(a.parentElement,"#a9a9a9")}function focusInMention(a){var b=window.getSelection();if(activeNode=b&&b.focusNode,optionPopUp&&(optionPopUp.removeEventListener("click",optionSelected),document.body.removeChild(optionPopUp),optionPopUp=null),activeNode.parentElement.mention_box){optionPopUp=prepareOptionsNode(a),document.body.append(optionPopUp),optionPopUp.addEventListener("click",optionSelected),optionPopUp.style.position="absolute";var c=b.focusNode,d=c.parentElement.getBoundingClientRect();optionPopUp.style.left=d.x+"px",optionPopUp.style.top=d.y+10+"px"}}function prepareOptionsNode(a){var b=document.createElement("ul");b.style.borderRadius="5px",b.style.backgroundColor="#fff",b.style.padding="3px",b.style.boxShadow="0 0 2PX 2PX #c3c0c0",b.style["list-style-type"]="none";for(var c,d=0;d<a.length;d++)c=document.createElement("li"),c.innerText=a[d].display_content,c.mention_id=a[d].id,b.append(c);return b.addEventListener("click",function(){}),b}function spaceTriggered(a){if("SPAN"==a.parentElement.nodeName){var b=createEmptyTextNode();insertAfter(a.parentElement,b),focusAt(b,1)}}function mentionTriggered(a,b){var c=createSpan(createTextNode("@",++id)),d=createTextNode(a.textContent.slice(b),++id);a.textContent=a.textContent.slice(0,b),c.mention_box=!0,"SPAN"==a.parentElement.nodeName?insertAfter(a.parentNode,c):insertAfter(a,c),insertAfter(c,d),focusAt(c,1)}function insertAfter(a,b){editBox.insertBefore(b,a.nextSibling)}function appendBefore(a,b){editBox.insertBefore(b,a)}function focusAt(a,b){debugger;var c=document.createRange();c.setStart(a,b),c.setEnd(a,b);var d=window.getSelection();d.removeAllRanges(),c.collapse(!0),d.addRange(c)}function createEmptyTextNode(){return createTextNode("\xA0",++id)}function createTextNode(a,b){var c=document.createTextNode(a);return c.chunk_id=b,c}function createSpan(a){var b=document.createElement("span");return b.append(a),applyColor(b,"#a9a9a9"),b}function applyColor(a,b){a.style.color=b}function prepareDataList(a){//  console.log("kkkk")
for(var b=[],c=a.first_chunk;null!=c&&a[c];)b.push(a[c]),c=a[c].next_chunk;return b}var props_={data:{raw_content:"@123 abc @567 bdfg ",mentions:[{start_index:0,end_index:3,id:"@123",display_content:"alpha"},{start_index:7,end_index:9,id:"@345",display_content:"beta"},{start_index:10,end_index:12,id:"@76",display_content:"gama 45"}]},callBack:function callBack(a){return console.log(a)},options:[{id:677,display_content:"jumba"},{id:358,display_content:"kalimba"}]};
//# sourceMappingURL=index.js.map