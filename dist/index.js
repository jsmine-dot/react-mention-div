"use strict";var _react=_interopRequireWildcard(require("react"));function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default;function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c.return||c.return()}finally{if(h)throw f}}}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=a&&("undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"]);if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var prntWrpr="prntWrpr",inrWrpr="inrWrpr",igoneKeyList=[27,//"escape"
16,//"shiftleft","shiftright"
17,//"controlleft"
18,//"altleft", "altright"
91,//"metaleft"
93,//"metaright"
37,//"arrowleft"
38,//"arrowup"
40,//"arrowdown"
39//"arrowright"
];function deBounce(a,b){var c=null;return function(){var d=arguments;c&&clearTimeout(c),c=setTimeout(function(){return a.apply(void 0,_toConsumableArray(d))},b)}}function _default(a){function b(a,b){var c=document.createRange();c.setStart(a,b),c.setEnd(a,b);var d=window.getSelection();d.removeAllRanges(),c.collapse(!0),d.addRange(c)}function c(){var a=window.getSelection().focusNode;if("#text"!=a.nodeName&&a.getAttribute("wrprTy")==prntWrpr){var b=k(),c=document.createElement("br");b.appendChild(c),a.innerHTML=null,a.appendChild(b)}}function d(){var a=window.getSelection().focusNode;if(a&&a.textContent.startsWith(s)){F(!0);var b=l(a,"wrprTy",inrWrpr),c=b.getBoundingClientRect();J(function(){return{top:c.y+c.height,left:c.x}}),R(function(){return l(a,"wrprTy",inrWrpr)})}else j()}function e(){var a=window.getSelection().focusNode,c=a.textContent,d=l(a,"wrprTy",inrWrpr);if(d){var e,g=_createForOfIteratorHelper(d.childNodes);try{for(g.s();!(e=g.n()).done;){var j=e.value;"BR"===j.nodeName&&d.removeChild(j)}}catch(a){g.e(a)}finally{g.f()}}else{var h=k(),i=l(a,"wrprTy",prntWrpr);h.appendChild(a),i.appendChild(h),b(a,c.length)}f()}function f(){var a=window.getSelection().focusNode,b=a.textContent,c=_toConsumableArray(b.matchAll(s)).map(function(a){return a.index});if(0!==c.length){var d=[];a.textContent=b.slice(0,c[0]);for(var f,g=0;g<c.length;g++)f=b.slice(c[g],c[g+1]),d.push(f);var e=l(a,"wrprTy",inrWrpr);d.forEach(function(a){var b={};a.startsWith(s)&&(b.color=x),i(e,a,b)})}}function g(a){i(Q,"&nbsp;"),Q.textContent=s+a[z],M[s+a[z]]=a,j(),h()}function h(){var a=window.getSelection().focusNode,b={};b.value=S.current.innerText;var c=[];Object.keys(M).forEach(function(a){b.value.includes(a)&&c.push(_objectSpread(_objectSpread({mentionKey:a},M[a]),{},{start:b.value.indexOf(a),end:b.value.indexOf(a)+a.length}))}),b.mentions=c,Q&&(b.searchKey=Q.textContent.slice(1)),u(b)}function i(a,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},e=k();Object.keys(d).forEach(function(a){e.style[a]=d[a]}),e.innerHTML=c,a.insertAdjacentElement("afterEnd",e),b(e.childNodes[0],e.innerText.length)}function j(){F(function(){return!1}),R(null)}function k(){var a=document.createElement("span");return a.setAttribute("wrprTy",inrWrpr),a}function l(a,b,c){for(var d=0;;)if("BODY"==a.nodeName||5<=d){a=null;break}else if(a.getAttribute&&a.getAttribute(b)==c)break;else a=a.parentNode,d++;return a}var m=a.className,n=a.style,o=void 0===n?{}:n,p=a.options,q=void 0===p?[]:p,r=a.trigger,s=void 0===r?"@":r,t=a.onChange,u=void 0===t?function(){}:t,v=a.optionsListClass,w=a.triggerColor,x=void 0===w?"#0E85E8":w,y=a.optionDisplayKey,z=void 0===y?"id":y,A=a.ListingUi,B=void 0===A?null:A,C=(0,_react.useState)(!1),D=_slicedToArray(C,2),E=D[0],F=D[1],G=(0,_react.useState)(null),H=_slicedToArray(G,2),I=H[0],J=H[1],K=(0,_react.useState)({}),L=_slicedToArray(K,2),M=L[0],N=L[1],O=(0,_react.useState)(null),P=_slicedToArray(O,2),Q=P[0],R=P[1],S=(0,_react.useRef)(),T=deBounce(function(a){if(!igoneKeyList.includes(a.keyCode)){var e=window.getSelection(),g=e.focusOffset,i=e.focusNode,j=i.textContent;if("backspace"===a.code.toLowerCase()&&c(),j.includes(s)&&!j.startsWith(s))f(a);else if("space"===a.code.toLowerCase()&&j.startsWith(s)){var m=i.textContent;i.textContent=m.slice(0,g-1);var n=k();n.innerHTML=m.slice(g-1,m.length);var o=l(i,"wrprTy",inrWrpr);o.insertAdjacentElement("afterEnd",n),b(n,1)}d(),h()}},100);return/*#__PURE__*/_react.default.createElement("div",null,/*#__PURE__*/_react.default.createElement("div",{wrprTy:prntWrpr,ref:S,className:m,style:_objectSpread({padding:"2px"},o),contentEditable:!0,onClick:function onClick(){return setTimeout(d,0)},onCut:function onCut(){return setTimeout(function(){return c()},0)},onPaste:function onPaste(){return setTimeout(function(){return e()},0)},onKeyUp:function onKeyUp(a){return T(a)}},/*#__PURE__*/_react.default.createElement("span",{wrprTy:inrWrpr},/*#__PURE__*/_react.default.createElement("br",null))),E&&I?/*#__PURE__*/_react.default.createElement(function(a){var b=a.style;return/*#__PURE__*/_react.default.createElement("div",{style:b,className:v},q.map(function(a){return/*#__PURE__*/_react.default.createElement("div",{onClick:function onClick(){return g(a)}},B?/*#__PURE__*/_react.default.createElement(B,{option:a}):/*#__PURE__*/_react.default.createElement("div",null,a[z]))}))},{style:{position:"fixed",top:I.top,left:I.left}}):null)}
//# sourceMappingURL=index.js.map